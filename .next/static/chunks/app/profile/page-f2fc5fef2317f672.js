(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{5285:function(e,t,s){Promise.resolve().then(s.bind(s,7939))},7939:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return m}});var a=s(7437),l=s(2265),n=s(2749),r=s(1396),i=s.n(r);function o(){var e,t,s;let{data:r,update:i}=(0,n.useSession)(),[o,c]=(0,l.useState)(!1),[d,m]=(0,l.useState)(null),[u,x]=(0,l.useState)(!1),[h,f]=(0,l.useState)({name:(null==r?void 0:null===(e=r.user)||void 0===e?void 0:e.name)||"",email:(null==r?void 0:null===(t=r.user)||void 0===t?void 0:t.email)||"",avatar:(null==r?void 0:null===(s=r.user)||void 0===s?void 0:s.image)||"",bio:"",company:"",position:""}),g=e=>{let{name:t,value:s}=e.target;f(e=>({...e,[t]:s}))},b=async e=>{e.preventDefault(),c(!0),m(null),x(!1);try{let e=await fetch("/api/user/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(!e.ok)throw Error("更新个人信息失败");let t=await e.json();await i(t),x(!0)}catch(e){m(e instanceof Error?e.message:"更新个人信息失败")}finally{c(!1)}};return(0,a.jsxs)("form",{onSubmit:b,className:"space-y-6",children:[d&&(0,a.jsx)("div",{className:"p-4 bg-red-50 text-red-600 rounded-lg",children:d}),u&&(0,a.jsx)("div",{className:"p-4 bg-green-50 text-green-600 rounded-lg",children:"个人信息更新成功！"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"昵称"}),(0,a.jsx)("input",{type:"text",id:"name",name:"name",value:h.name,onChange:g,className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"邮箱"}),(0,a.jsx)("input",{type:"email",id:"email",name:"email",value:h.email,onChange:g,className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 bg-gray-50",disabled:!0}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"邮箱地址不可修改"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"avatar",className:"block text-sm font-medium text-gray-700",children:"头像链接"}),(0,a.jsx)("input",{type:"url",id:"avatar",name:"avatar",value:h.avatar,onChange:g,className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"https://example.com/avatar.jpg"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"bio",className:"block text-sm font-medium text-gray-700",children:"个人简介"}),(0,a.jsx)("textarea",{id:"bio",name:"bio",value:h.bio,onChange:g,rows:3,className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"介绍一下你自己..."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"company",className:"block text-sm font-medium text-gray-700",children:"公司"}),(0,a.jsx)("input",{type:"text",id:"company",name:"company",value:h.company,onChange:g,className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"你所在的公司"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"position",className:"block text-sm font-medium text-gray-700",children:"职位"}),(0,a.jsx)("input",{type:"text",id:"position",name:"position",value:h.position,onChange:g,className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"你的职位"})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{type:"submit",disabled:o,className:"px-6 py-2 rounded-lg text-white font-medium ".concat(o?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),children:o?"保存中...":"保存修改"})})]})}function c(){let{data:e}=(0,n.useSession)(),[t,s]=(0,l.useState)([]),[r,o]=(0,l.useState)(!0),[c,d]=(0,l.useState)(null),[m,u]=(0,l.useState)({total:0,page:1,limit:10,totalPages:0}),[x,h]=(0,l.useState)(!1),f=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{let a=await fetch("/api/user/comments?page=".concat(e,"&limit=").concat(m.limit));if(!a.ok)throw Error("获取评论失败");let l=await a.json();t?s(e=>[...e,...l.comments]):s(l.comments),u(l.pagination)}catch(e){d(e instanceof Error?e.message:"获取评论失败")}finally{o(!1),h(!1)}};(0,l.useEffect)(()=>{f()},[]);let g=async()=>{x||m.page>=m.totalPages||(h(!0),await f(m.page+1,!0))},b=async e=>{if(confirm("确定要删除这条评论吗？"))try{if(!(await fetch("/api/comments/".concat(e),{method:"DELETE"})).ok)throw Error("删除评论失败");s(t=>t.filter(t=>t._id!==e)),u(e=>({...e,total:e.total-1}))}catch(e){d(e instanceof Error?e.message:"删除评论失败")}};return r?(0,a.jsx)("div",{className:"text-center py-8",children:"加载评论中..."}):c?(0,a.jsx)("div",{className:"p-4 bg-red-50 text-red-600 rounded-lg",children:c}):0===t.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"还没有发表过评论"}):(0,a.jsxs)("div",{className:"space-y-6",children:[t.map(e=>(0,a.jsx)("div",{className:"bg-white rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(i(),{href:"/news/".concat(e.newsId),className:"text-lg font-medium text-gray-900 hover:text-blue-600",children:e.newsTitle}),(0,a.jsx)("div",{className:"mt-2 text-gray-600 prose prose-sm",dangerouslySetInnerHTML:{__html:e.content}}),(0,a.jsxs)("div",{className:"mt-4 flex items-center space-x-4 text-sm text-gray-500",children:[(0,a.jsx)("span",{children:new Date(e.createdAt).toLocaleString()}),(0,a.jsx)("span",{children:"•"}),(0,a.jsxs)("span",{children:[e.likes," 赞"]}),(0,a.jsx)("span",{children:"•"}),(0,a.jsxs)("span",{children:[e.replyCount," 回复"]})]})]}),(0,a.jsx)("button",{onClick:()=>b(e._id),className:"text-red-600 hover:text-red-700 text-sm",children:"删除"})]})},e._id)),m.page<m.totalPages&&(0,a.jsx)("div",{className:"flex justify-center mt-8",children:(0,a.jsx)("button",{onClick:g,disabled:x,className:"px-6 py-2 rounded-lg text-white font-medium ".concat(x?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),children:x?"加载中...":"加载更多评论"})})]})}function d(){let{data:e}=(0,n.useSession)(),[t,s]=(0,l.useState)([]),[r,i]=(0,l.useState)(!0),[o,c]=(0,l.useState)(null),[d,m]=(0,l.useState)({total:0,page:1,limit:10,totalPages:0}),[u,x]=(0,l.useState)(!1),h=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{let a=await fetch("/api/user/notifications?page=".concat(e,"&limit=").concat(d.limit));if(!a.ok)throw Error("获取通知失败");let l=await a.json();t?s(e=>[...e,...l.notifications]):s(l.notifications),m(l.pagination)}catch(e){c(e instanceof Error?e.message:"获取通知失败")}finally{i(!1),x(!1)}};(0,l.useEffect)(()=>{h()},[]);let f=async()=>{u||d.page>=d.totalPages||(x(!0),await h(d.page+1,!0))},g=async e=>{try{if(!(await fetch("/api/user/notifications/".concat(e,"/read"),{method:"PUT"})).ok)throw Error("标记通知失败");s(t=>t.map(t=>t._id===e?{...t,isRead:!0}:t))}catch(e){c(e instanceof Error?e.message:"标记通知失败")}},b=async()=>{try{if(!(await fetch("/api/user/notifications/read-all",{method:"PUT"})).ok)throw Error("标记通知失败");s(e=>e.map(e=>({...e,isRead:!0})))}catch(e){c(e instanceof Error?e.message:"标记通知失败")}},p=e=>{switch(e){case"comment_reply":return(0,a.jsx)("svg",{className:"w-6 h-6 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})});case"comment_like":return(0,a.jsx)("svg",{className:"w-6 h-6 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"})});case"follow":return(0,a.jsx)("svg",{className:"w-6 h-6 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})});default:return(0,a.jsx)("svg",{className:"w-6 h-6 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}};return r?(0,a.jsx)("div",{className:"text-center py-8",children:"加载通知中..."}):o?(0,a.jsx)("div",{className:"p-4 bg-red-50 text-red-600 rounded-lg",children:o}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["共 ",d.total," 条通知，",t.filter(e=>!e.isRead).length," 条未读"]}),t.some(e=>!e.isRead)&&(0,a.jsx)("button",{onClick:b,className:"text-sm text-blue-600 hover:text-blue-700",children:"全部标记为已读"})]}),0===t.length?(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"暂无通知消息"}):(0,a.jsxs)("div",{className:"space-y-4",children:[t.map(e=>(0,a.jsx)("div",{className:"p-4 rounded-lg ".concat(e.isRead?"bg-white":"bg-blue-50"," hover:shadow-md transition-shadow"),children:(0,a.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:p(e.type)}),(0,a.jsxs)("div",{className:"flex-grow",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsx)("h3",{className:"text-base font-medium text-gray-900",children:e.title}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:new Date(e.createdAt).toLocaleString()}),!e.isRead&&(0,a.jsx)("button",{onClick:()=>g(e._id),className:"text-sm text-blue-600 hover:text-blue-700",children:"标记已读"})]})]}),(0,a.jsx)("p",{className:"mt-1 text-gray-600",children:e.content}),e.sender&&(0,a.jsxs)("div",{className:"mt-2 flex items-center space-x-2",children:[e.sender.image?(0,a.jsx)("img",{src:e.sender.image,alt:e.sender.name,className:"w-5 h-5 rounded-full"}):(0,a.jsx)("div",{className:"w-5 h-5 rounded-full bg-blue-100 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xs font-medium text-blue-600",children:e.sender.name.charAt(0)})}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:e.sender.name})]})]})]})},e._id)),d.page<d.totalPages&&(0,a.jsx)("div",{className:"flex justify-center mt-8",children:(0,a.jsx)("button",{onClick:f,disabled:u,className:"px-6 py-2 rounded-lg text-white font-medium ".concat(u?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),children:u?"加载中...":"加载更多通知"})})]})]})}function m(){var e,t,s,r,m;let{data:u,status:x}=(0,n.useSession)(),[h,f]=(0,l.useState)("profile");return"loading"===x?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"加载中..."}):u?(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm",children:[(0,a.jsx)("div",{className:"p-6 border-b",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(null===(e=u.user)||void 0===e?void 0:e.image)?(0,a.jsx)("img",{src:u.user.image,alt:u.user.name||"用户头像",className:"w-20 h-20 rounded-full"}):(0,a.jsx)("div",{className:"w-20 h-20 rounded-full bg-blue-100 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-2xl font-bold text-blue-600",children:(null===(s=u.user)||void 0===s?void 0:null===(t=s.name)||void 0===t?void 0:t.charAt(0))||"U"})})}),(0,a.jsxs)("div",{className:"ml-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:(null===(r=u.user)||void 0===r?void 0:r.name)||"未设置昵称"}),(0,a.jsx)("p",{className:"text-gray-500",children:null===(m=u.user)||void 0===m?void 0:m.email})]})]})}),(0,a.jsx)("div",{className:"border-b",children:(0,a.jsxs)("nav",{className:"flex",children:[(0,a.jsx)("button",{onClick:()=>f("profile"),className:"px-6 py-3 text-sm font-medium ".concat("profile"===h?"border-b-2 border-blue-600 text-blue-600":"text-gray-500 hover:text-gray-700"),children:"个人信息"}),(0,a.jsx)("button",{onClick:()=>f("comments"),className:"px-6 py-3 text-sm font-medium ".concat("comments"===h?"border-b-2 border-blue-600 text-blue-600":"text-gray-500 hover:text-gray-700"),children:"我的评论"}),(0,a.jsx)("button",{onClick:()=>f("notifications"),className:"px-6 py-3 text-sm font-medium ".concat("notifications"===h?"border-b-2 border-blue-600 text-blue-600":"text-gray-500 hover:text-gray-700"),children:"通知消息"}),(0,a.jsx)("button",{onClick:()=>f("following"),className:"px-6 py-3 text-sm font-medium ".concat("following"===h?"border-b-2 border-blue-600 text-blue-600":"text-gray-500 hover:text-gray-700"),children:"关注内容"})]})}),(0,a.jsxs)("div",{className:"p-6",children:["profile"===h&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"个人信息"}),(0,a.jsx)(o,{})]}),"comments"===h&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"我的评论"}),(0,a.jsx)(c,{})]}),"notifications"===h&&(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)(d,{})}),"following"===h&&(0,a.jsx)("div",{children:(0,a.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"关注内容"})})]})]})}):(0,a.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"请先登录"}),(0,a.jsx)(i(),{href:"/auth/signin",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"去登录"})]})}}},function(e){e.O(0,[250,674,971,938,744],function(){return e(e.s=5285)}),_N_E=e.O()}]);